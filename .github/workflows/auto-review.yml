name: Auto Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Claude Code Review
        uses: anthropics/claude-code-action@main
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          direct_prompt: |
            Review this pull request and post a comment with your findings.

            ## Review Guidelines

            This is an ADVISORY review only. Do not request changes or block the PR.
            Focus on being helpful, not gatekeeping.

            ### What to check:
            - Potential bugs, edge cases, and error handling gaps
            - Security concerns (XSS, injection, exposed secrets)
            - For React components: hooks usage, accessibility, TypeScript types
            - For TypeScript: error handling, type safety, async/await, null checks
            - For config files: exposed secrets, valid syntax

            ### Output Format

            Post a PR comment structured as:

            ## Code Review

            ### Summary
            One sentence overall assessment.

            ### Findings
            For each file with feedback:
            **filename** (lines X-Y): Issue or suggestion

            If a file looks good, say: **filename** - Looks good!

            ### Verdict
            One of:
            - ‚úÖ **Looks good** - No blocking issues
            - ‚ö†Ô∏è **Minor suggestions** - Safe to merge, consider the feedback
            - üîç **Needs discussion** - Some items worth talking through

            Remember: Be constructive and helpful, not a gatekeeper.
